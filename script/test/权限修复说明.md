# å²—ä½æ‹›è˜æƒé™ä¿®å¤è¯´æ˜

## ğŸ¯ é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼šè§£ç»‘ä¼ä¸šèº«ä»½åï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨ `POST /designer/job` æ¥å£å‘å¸ƒå²—ä½ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸¥é‡çš„æƒé™æ§åˆ¶æ¼æ´ã€‚

### åŸå§‹é—®é¢˜
- ç”¨æˆ·å¯ä»¥åœ¨è§£ç»‘ä¼ä¸šèº«ä»½åç»§ç»­å‘å¸ƒå²—ä½
- æ²¡æœ‰éªŒè¯ç”¨æˆ·çš„ä¼ä¸šèº«ä»½çŠ¶æ€
- å­˜åœ¨æ•°æ®å®‰å…¨éšæ‚£

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### 1. æ·»åŠ ä¼ä¸šèº«ä»½éªŒè¯

åœ¨ `JobPostingController` ä¸­çš„å…³é”®æ–¹æ³•æ·»åŠ äº†ä¼ä¸šèº«ä»½éªŒè¯ï¼š

#### å‘å¸ƒå²—ä½æ¥å£ (`POST /designer/job`)
```java
@PostMapping
public R<Void> add(@Validated @RequestBody JobPosting jobPosting) {
    // éªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦ä¸ºä¼ä¸šç”¨æˆ·
    if (!permissionUtils.isEnterprise()) {
        return R.fail("åªæœ‰ä¼ä¸šç”¨æˆ·æ‰èƒ½å‘å¸ƒå²—ä½");
    }
    
    // è·å–å½“å‰ç”¨æˆ·ç»‘å®šçš„ä¼ä¸šID
    Long enterpriseId = permissionUtils.getCurrentEnterpriseId();
    if (enterpriseId == null) {
        return R.fail("æœªæ‰¾åˆ°ä¼ä¸šèº«ä»½ï¼Œè¯·å…ˆæ³¨å†Œä¼ä¸šè´¦æˆ·");
    }
    
    // è®¾ç½®ä¼ä¸šIDåˆ°å²—ä½ä¿¡æ¯ä¸­
    jobPosting.setEnterpriseId(enterpriseId);
    
    return toAjax(jobPostingService.insertJobPosting(jobPosting));
}
```

#### ä¿®æ”¹å²—ä½æ¥å£ (`PUT /designer/job`)
```java
@PutMapping
public R<Void> edit(@Validated @RequestBody JobPosting jobPosting) {
    // éªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦ä¸ºä¼ä¸šç”¨æˆ·
    if (!permissionUtils.isEnterprise()) {
        return R.fail("åªæœ‰ä¼ä¸šç”¨æˆ·æ‰èƒ½ä¿®æ”¹å²—ä½");
    }
    
    // éªŒè¯å²—ä½å½’å±æƒé™
    JobPosting existingJob = jobPostingService.selectJobPostingById(jobPosting.getJobId());
    if (existingJob == null) {
        return R.fail("å²—ä½ä¸å­˜åœ¨");
    }
    
    if (!permissionUtils.hasEnterprisePermission(existingJob.getEnterpriseId())) {
        return R.fail("æ— æƒé™ä¿®æ”¹æ­¤å²—ä½");
    }
    
    return toAjax(jobPostingService.updateJobPosting(jobPosting));
}
```

#### åˆ é™¤å²—ä½æ¥å£ (`DELETE /designer/job/{jobIds}`)
```java
@DeleteMapping("/{jobIds}")
public R<Void> remove(@PathVariable Long[] jobIds) {
    // éªŒè¯å½“å‰ç”¨æˆ·æ˜¯å¦ä¸ºä¼ä¸šç”¨æˆ·
    if (!permissionUtils.isEnterprise()) {
        return R.fail("åªæœ‰ä¼ä¸šç”¨æˆ·æ‰èƒ½åˆ é™¤å²—ä½");
    }
    
    // éªŒè¯æ‰€æœ‰å²—ä½çš„å½’å±æƒé™
    for (Long jobId : jobIds) {
        JobPosting existingJob = jobPostingService.selectJobPostingById(jobId);
        if (existingJob == null) {
            return R.fail("å²—ä½ä¸å­˜åœ¨: " + jobId);
        }
        
        if (!permissionUtils.hasEnterprisePermission(existingJob.getEnterpriseId())) {
            return R.fail("æ— æƒé™åˆ é™¤å²—ä½: " + jobId);
        }
    }
    
    return toAjax(jobPostingService.deleteJobPostingByIds(Arrays.asList(jobIds)));
}
```

#### ä¼ä¸šå²—ä½æŸ¥è¯¢æ¥å£ (`GET /designer/job/enterprise/{enterpriseId}`)
```java
@GetMapping("/enterprise/{enterpriseId}")
public R<List<JobPosting>> getByEnterprise(@PathVariable Long enterpriseId) {
    // éªŒè¯æƒé™ï¼šåªæœ‰è¯¥ä¼ä¸šç”¨æˆ·æˆ–ç®¡ç†å‘˜æ‰èƒ½æŸ¥è¯¢ä¼ä¸šå²—ä½
    if (!permissionUtils.hasEnterprisePermission(enterpriseId)) {
        return R.fail("æ— æƒé™æŸ¥è¯¢è¯¥ä¼ä¸šçš„å²—ä½ä¿¡æ¯");
    }
    
    return R.ok(jobPostingService.selectJobPostingByEnterprise(enterpriseId));
}
```

### 2. æƒé™éªŒè¯é€»è¾‘

#### ä½¿ç”¨çš„æƒé™å·¥å…·ç±»æ–¹æ³•
- `permissionUtils.isEnterprise()` - æ£€æŸ¥å½“å‰ç”¨æˆ·æ˜¯å¦ä¸ºä¼ä¸šç”¨æˆ·
- `permissionUtils.getCurrentEnterpriseId()` - è·å–å½“å‰ç”¨æˆ·ç»‘å®šçš„ä¼ä¸šID
- `permissionUtils.hasEnterprisePermission(enterpriseId)` - æ£€æŸ¥ç”¨æˆ·å¯¹ç‰¹å®šä¼ä¸šçš„æƒé™

#### éªŒè¯å±‚çº§
1. **èº«ä»½éªŒè¯**: æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å…·æœ‰ä¼ä¸šèº«ä»½
2. **å®ä½“ç»‘å®šéªŒè¯**: ç¡®è®¤ç”¨æˆ·ç»‘å®šçš„ä¼ä¸šIDæœ‰æ•ˆ
3. **æ•°æ®å½’å±éªŒè¯**: ç¡®ä¿ç”¨æˆ·åªèƒ½æ“ä½œè‡ªå·±ä¼ä¸šçš„å²—ä½

## âœ… ä¿®å¤æ•ˆæœ

### ç°åœ¨çš„è¡Œä¸º
1. **è§£ç»‘ä¼ä¸šèº«ä»½å**ï¼š
   - âŒ æ— æ³•å‘å¸ƒæ–°å²—ä½
   - âŒ æ— æ³•ä¿®æ”¹å·²å‘å¸ƒçš„å²—ä½
   - âŒ æ— æ³•åˆ é™¤å·²å‘å¸ƒçš„å²—ä½
   - âŒ æ— æ³•æŸ¥è¯¢ä¼ä¸šå²—ä½åˆ—è¡¨

2. **ä¼ä¸šç”¨æˆ·**ï¼š
   - âœ… å¯ä»¥å‘å¸ƒå²—ä½ï¼ˆè‡ªåŠ¨è®¾ç½®ä¸ºå½“å‰ä¼ä¸šï¼‰
   - âœ… å¯ä»¥ä¿®æ”¹è‡ªå·±ä¼ä¸šçš„å²—ä½
   - âœ… å¯ä»¥åˆ é™¤è‡ªå·±ä¼ä¸šçš„å²—ä½
   - âœ… å¯ä»¥æŸ¥è¯¢è‡ªå·±ä¼ä¸šçš„å²—ä½

3. **è¶…çº§ç®¡ç†å‘˜**ï¼š
   - âœ… å¯ä»¥æ“ä½œæ‰€æœ‰ä¼ä¸šçš„å²—ä½
   - âœ… æ‹¥æœ‰å®Œæ•´çš„ç®¡ç†æƒé™

### é”™è¯¯æç¤ºä¿¡æ¯
- `"åªæœ‰ä¼ä¸šç”¨æˆ·æ‰èƒ½å‘å¸ƒå²—ä½"`
- `"æœªæ‰¾åˆ°ä¼ä¸šèº«ä»½ï¼Œè¯·å…ˆæ³¨å†Œä¼ä¸šè´¦æˆ·"`
- `"æ— æƒé™ä¿®æ”¹æ­¤å²—ä½"`
- `"æ— æƒé™åˆ é™¤å²—ä½: {jobId}"`
- `"æ— æƒé™æŸ¥è¯¢è¯¥ä¼ä¸šçš„å²—ä½ä¿¡æ¯"`

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•åœºæ™¯
1. **è§£ç»‘ä¼ä¸šèº«ä»½æµ‹è¯•**
   ```bash
   # 1. ç”¨æˆ·æ³¨å†Œä¼ä¸šèº«ä»½
   POST /designer/user/register/enterprise
   
   # 2. å‘å¸ƒå²—ä½ï¼ˆåº”è¯¥æˆåŠŸï¼‰
   POST /designer/job
   
   # 3. è§£ç»‘ä¼ä¸šèº«ä»½
   PUT /designer/user/unbind/enterprise
   
   # 4. å°è¯•å†æ¬¡å‘å¸ƒå²—ä½ï¼ˆåº”è¯¥å¤±è´¥ï¼‰
   POST /designer/job
   ```
   
   **é¢„æœŸç»“æœ**: ç¬¬4æ­¥è¿”å› `"åªæœ‰ä¼ä¸šç”¨æˆ·æ‰èƒ½å‘å¸ƒå²—ä½"`

2. **è·¨ä¼ä¸šæƒé™æµ‹è¯•**
   ```bash
   # 1. ä¼ä¸šAç”¨æˆ·å°è¯•ä¿®æ”¹ä¼ä¸šBçš„å²—ä½
   PUT /designer/job (jobId: ä¼ä¸šBçš„å²—ä½ID)
   ```
   
   **é¢„æœŸç»“æœ**: è¿”å› `"æ— æƒé™ä¿®æ”¹æ­¤å²—ä½"`

3. **éä¼ä¸šç”¨æˆ·æµ‹è¯•**
   ```bash
   # 1. è®¾è®¡å¸ˆç”¨æˆ·å°è¯•å‘å¸ƒå²—ä½
   POST /designer/job
   ```
   
   **é¢„æœŸç»“æœ**: è¿”å› `"åªæœ‰ä¼ä¸šç”¨æˆ·æ‰èƒ½å‘å¸ƒå²—ä½"`

## ğŸ“‹ å®‰å…¨åŠ å›º

### 1. å¤šå±‚æƒé™éªŒè¯
- Sa-Tokenæƒé™æ³¨è§£ï¼š`@SaCheckPermission("designer:job:add")`
- ä¼ä¸šèº«ä»½éªŒè¯ï¼š`permissionUtils.isEnterprise()`
- æ•°æ®å½’å±éªŒè¯ï¼š`permissionUtils.hasEnterprisePermission(enterpriseId)`

### 2. è‡ªåŠ¨è®¾ç½®ä¼ä¸šID
- å‘å¸ƒå²—ä½æ—¶è‡ªåŠ¨è®¾ç½®ä¸ºå½“å‰ç”¨æˆ·ç»‘å®šçš„ä¼ä¸šID
- é˜²æ­¢ç”¨æˆ·æ‰‹åŠ¨æŒ‡å®šå…¶ä»–ä¼ä¸šID

### 3. å®æ—¶èº«ä»½æ£€æŸ¥
- æ¯æ¬¡æ“ä½œéƒ½è¿›è¡Œå®æ—¶çš„èº«ä»½çŠ¶æ€æ£€æŸ¥
- ç¡®ä¿è§£ç»‘åç«‹å³ç”Ÿæ•ˆ

## ğŸ”„ å‘åå…¼å®¹æ€§

- ä¿®æ”¹ä»…å½±å“æƒé™éªŒè¯é€»è¾‘ï¼Œä¸å½±å“æ•°æ®ç»“æ„
- ç°æœ‰çš„å²—ä½æ•°æ®å’Œæ¥å£å“åº”æ ¼å¼ä¿æŒä¸å˜
- ç®¡ç†å‘˜æƒé™ä¸å—å½±å“

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ç®¡ç†å‘˜ç‰¹æƒ**: è¶…çº§ç®¡ç†å‘˜ä»ç„¶å¯ä»¥æ“ä½œæ‰€æœ‰å²—ä½
2. **é”™è¯¯å¤„ç†**: æä¾›æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯ï¼Œä¾¿äºç”¨æˆ·ç†è§£
3. **æ€§èƒ½å½±å“**: æƒé™æ£€æŸ¥å¯¹æ¥å£æ€§èƒ½å½±å“æå°
4. **æ—¥å¿—è®°å½•**: æƒé™éªŒè¯å¤±è´¥ä¼šè¢«è®°å½•åœ¨æ“ä½œæ—¥å¿—ä¸­

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

1. **æ·»åŠ å•å…ƒæµ‹è¯•**: ä¸ºæƒé™éªŒè¯é€»è¾‘ç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•
2. **å®¡è®¡æ—¥å¿—**: è®°å½•æ‰€æœ‰æƒé™éªŒè¯å¤±è´¥çš„æ“ä½œ
3. **å‰ç«¯é€‚é…**: å‰ç«¯éœ€è¦æ ¹æ®ç”¨æˆ·èº«ä»½çŠ¶æ€æ˜¾ç¤º/éšè—æ“ä½œæŒ‰é’®
4. **æ‰¹é‡æ“ä½œä¼˜åŒ–**: å¯¹äºæ‰¹é‡åˆ é™¤ç­‰æ“ä½œï¼Œå¯ä»¥è€ƒè™‘äº‹åŠ¡å›æ»šæœºåˆ¶

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-06-13  
**å½±å“èŒƒå›´**: å²—ä½æ‹›è˜ç›¸å…³æ¥å£  
**é£é™©ç­‰çº§**: ä½ï¼ˆä»…åŠ å¼ºæƒé™æ§åˆ¶ï¼‰ 