# è§£ç»‘ç”¨æˆ·èº«ä»½æ¥å£æƒé™ä¿®å¤

## ğŸ” é—®é¢˜æè¿°

ç”¨æˆ·åœ¨è°ƒç”¨ `/designer/user/unbind/{entityType}` æ¥å£è§£ç»‘èº«ä»½æ—¶ï¼Œè¿”å›403æƒé™é”™è¯¯ï¼š

```json
{
    "code": 403,
    "msg": "æ²¡æœ‰è®¿é—®æƒé™ï¼Œè¯·è”ç³»ç®¡ç†å‘˜æˆæƒ",
    "data": null
}
```

## ğŸ¯ é—®é¢˜åŸå› 

åŸå§‹æ¥å£ä½¿ç”¨äº† `@SaCheckPermission("designer:user:unbind")` æƒé™æ£€æŸ¥ï¼Œéœ€è¦ç‰¹å®šçš„ç³»ç»Ÿæƒé™æ‰èƒ½è®¿é—®ã€‚ä½†å¯¹äºç”¨æˆ·è‡ªè¡Œè§£ç»‘èº«ä»½çš„æ“ä½œï¼Œè¿™åº”è¯¥æ˜¯ä¸€ä¸ªåŸºæœ¬æƒé™ï¼Œåªè¦æ˜¯å·²ç™»å½•ç”¨æˆ·å°±åº”è¯¥èƒ½å¤Ÿæ‰§è¡Œã€‚

## âœ… è§£å†³æ–¹æ¡ˆ

### æƒé™æ³¨è§£ä¿®æ”¹

**ä¿®æ”¹å‰**:
```java
@SaCheckPermission("designer:user:unbind")
@Log(title = "è§£ç»‘ç”¨æˆ·èº«ä»½", businessType = BusinessType.UPDATE)
@PutMapping("/unbind/{entityType}")
public R<Void> unbindUserIdentity(@PathVariable String entityType) {
```

**ä¿®æ”¹å**:
```java
@SaCheckLogin
@Log(title = "è§£ç»‘ç”¨æˆ·èº«ä»½", businessType = BusinessType.UPDATE)
@PutMapping("/unbind/{entityType}")
public R<Void> unbindUserIdentity(@PathVariable String entityType) {
```

### æƒé™çº§åˆ«å¯¹æ¯”

| æƒé™æ³¨è§£ | æƒé™çº§åˆ« | é€‚ç”¨åœºæ™¯ | è¯´æ˜ |
|---------|---------|----------|------|
| `@SaCheckPermission("designer:user:unbind")` | ç³»ç»Ÿç®¡ç†å‘˜æƒé™ | ç®¡ç†å‘˜æ“ä½œ | éœ€è¦ç‰¹å®šæƒé™é…ç½® |
| `@SaCheckLogin` | ç™»å½•ç”¨æˆ·æƒé™ | ç”¨æˆ·è‡ªåŠ©æ“ä½œ | åªéœ€è¦ç™»å½•å³å¯ |

## ğŸ”’ å®‰å…¨æ€§ä¿éšœ

è™½ç„¶é™ä½äº†æƒé™è¦æ±‚ï¼Œä½†æ¥å£ä»ç„¶æ˜¯å®‰å…¨çš„ï¼š

### 1. ç”¨æˆ·èº«ä»½éªŒè¯
- `@SaCheckLogin` ç¡®ä¿åªæœ‰å·²ç™»å½•ç”¨æˆ·æ‰èƒ½è®¿é—®
- `LoginHelper.getUserId()` è·å–å½“å‰ç™»å½•ç”¨æˆ·ID

### 2. æƒé™èŒƒå›´é™åˆ¶
- ç”¨æˆ·åªèƒ½è§£ç»‘è‡ªå·±çš„èº«ä»½ï¼ˆé€šè¿‡userIdé™åˆ¶ï¼‰
- æ— æ³•è§£ç»‘å…¶ä»–ç”¨æˆ·çš„èº«ä»½
- æ— æ³•è¿›è¡Œè¶Šæƒæ“ä½œ

### 3. ä¸šåŠ¡é€»è¾‘éªŒè¯
```java
Long userId = LoginHelper.getUserId(); // è·å–å½“å‰ç”¨æˆ·ID
userBindingService.unbindUserFromEntity(userId, type); // åªè§£ç»‘å½“å‰ç”¨æˆ·
```

## ğŸš€ æµ‹è¯•éªŒè¯

### 1. Apifoxæµ‹è¯•é…ç½®

**æ¥å£**: `PUT {{base_url}}/designer/user/unbind/{entityType}`

**Headers**:
```
Authorization: Bearer {{access_token}}
```

**è·¯å¾„å‚æ•°**:
- `entityType`: å®ä½“ç±»å‹
  - `designer` - è§£ç»‘è®¾è®¡å¸ˆèº«ä»½
  - `enterprise` - è§£ç»‘ä¼ä¸šèº«ä»½
  - `school` - è§£ç»‘é™¢æ ¡èº«ä»½

### 2. æµ‹è¯•ç”¨ä¾‹

#### æµ‹è¯•ç”¨ä¾‹1ï¼šè§£ç»‘è®¾è®¡å¸ˆèº«ä»½
```
PUT /designer/user/unbind/designer
```

**é¢„æœŸç»“æœ**:
```json
{
    "code": 200,
    "msg": "æ“ä½œæˆåŠŸ",
    "data": null
}
```

#### æµ‹è¯•ç”¨ä¾‹2ï¼šè§£ç»‘ä¼ä¸šèº«ä»½
```
PUT /designer/user/unbind/enterprise
```

#### æµ‹è¯•ç”¨ä¾‹3ï¼šè§£ç»‘é™¢æ ¡èº«ä»½
```
PUT /designer/user/unbind/school
```

#### æµ‹è¯•ç”¨ä¾‹4ï¼šæ— æ•ˆå®ä½“ç±»å‹
```
PUT /designer/user/unbind/invalid
```

**é¢„æœŸç»“æœ**:
```json
{
    "code": 500,
    "msg": "æ— æ•ˆçš„å®ä½“ç±»å‹",
    "data": null
}
```

### 3. éªŒè¯æ–¹æ³•

#### æ•°æ®åº“éªŒè¯
è§£ç»‘æˆåŠŸåï¼Œæ£€æŸ¥æ•°æ®åº“ï¼š
```sql
SELECT binding_status 
FROM des_user_binding 
WHERE user_id = {å½“å‰ç”¨æˆ·ID} AND entity_type = '{entityType}';
```

**é¢„æœŸç»“æœ**: `binding_status` åº”è¯¥å˜ä¸º `'0'`ï¼ˆè§£ç»‘çŠ¶æ€ï¼‰

#### æ¥å£éªŒè¯
è°ƒç”¨ç»‘å®šä¿¡æ¯æŸ¥è¯¢æ¥å£ç¡®è®¤ï¼š
```
GET /designer/user/bindings
```

è§£ç»‘çš„èº«ä»½åº”è¯¥ä¸å†å‡ºç°åœ¨è¿”å›åˆ—è¡¨ä¸­ã€‚

## ğŸ“‹ ç®¡ç†å‘˜æ¥å£ä¿æŒä¸å˜

ç®¡ç†å‘˜ç»‘å®šæ¥å£ä»ç„¶ä¿æŒåŸæœ‰æƒé™ï¼š

```java
@SaCheckPermission("designer:user:bind")
@PostMapping("/bind")
public R<Void> bindUserToEntity(@RequestParam Long userId,
                                @RequestParam String entityType,
                                @RequestParam Long entityId)
```

è¿™ç¡®ä¿äº†ï¼š
- ç”¨æˆ·å¯ä»¥è‡ªè¡Œè§£ç»‘èº«ä»½ï¼ˆè‡ªåŠ©æœåŠ¡ï¼‰
- åªæœ‰ç®¡ç†å‘˜å¯ä»¥ä¸ºå…¶ä»–ç”¨æˆ·ç»‘å®šèº«ä»½ï¼ˆæƒé™æ§åˆ¶ï¼‰

## ğŸ¯ æƒé™è®¾è®¡åŸåˆ™

### è‡ªåŠ©æ“ä½œæƒé™
- **è§£ç»‘èº«ä»½**: `@SaCheckLogin` - ç”¨æˆ·å¯ä»¥è‡ªè¡Œè§£ç»‘
- **æŸ¥è¯¢è‡ªå·±çš„ç»‘å®šä¿¡æ¯**: æ— ç‰¹æ®Šæƒé™è¦æ±‚
- **æ³¨å†Œæ–°èº«ä»½**: æ— ç‰¹æ®Šæƒé™è¦æ±‚

### ç®¡ç†å‘˜æ“ä½œæƒé™
- **ä¸ºå…¶ä»–ç”¨æˆ·ç»‘å®šèº«ä»½**: `@SaCheckPermission("designer:user:bind")`
- **æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·ç»‘å®š**: éœ€è¦ç®¡ç†å‘˜æƒé™
- **å¼ºåˆ¶è§£ç»‘å…¶ä»–ç”¨æˆ·**: éœ€è¦ç®¡ç†å‘˜æƒé™

## âœ… ä¿®å¤å®Œæˆ

ç°åœ¨ç”¨æˆ·å¯ä»¥ï¼š
1. âœ… è‡ªè¡Œæ³¨å†Œè®¾è®¡å¸ˆ/ä¼ä¸š/é™¢æ ¡èº«ä»½
2. âœ… æŸ¥è¯¢è‡ªå·±çš„ç»‘å®šä¿¡æ¯
3. âœ… è‡ªè¡Œè§£ç»‘ä»»ä½•å·²ç»‘å®šçš„èº«ä»½
4. âœ… æ— éœ€è”ç³»ç®¡ç†å‘˜è¿›è¡Œè§£ç»‘æ“ä½œ

è¿™ç§æƒé™è®¾è®¡æ—¢ä¿è¯äº†ç”¨æˆ·çš„è‡ªä¸»æ€§ï¼Œåˆç»´æŠ¤äº†ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚ 