# ä¼˜åŒ–è§£ç»‘æ¥å£è¿”å›ä¿¡æ¯

## ğŸ” é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼šå½“æ²¡æœ‰ä»»ä½•ç»‘å®šæ—¶ï¼Œé‡å¤è°ƒç”¨è§£ç»‘æ¥å£ä»ç„¶è¿”å›"æ“ä½œæˆåŠŸ"ï¼Œè¿™ä¼šé€ æˆè¯¯è§£ã€‚ç”¨æˆ·æœŸæœ›åœ¨æ²¡æœ‰ç»‘å®šæ—¶å¾—åˆ°æ›´æ˜ç¡®çš„æç¤ºä¿¡æ¯ã€‚

### åŸå§‹è¡Œä¸º
```json
// æ— è®ºæ˜¯å¦æœ‰ç»‘å®šï¼Œéƒ½è¿”å›ç›¸åŒç»“æœ
{
    "code": 200,
    "msg": "æ“ä½œæˆåŠŸ",
    "data": null
}
```

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

æä¾›æ›´å‡†ç¡®ã€æ›´æœ‰æ„ä¹‰çš„APIå“åº”ï¼Œè®©ç”¨æˆ·æ¸…æ¥šäº†è§£æ“ä½œçš„å®é™…ç»“æœï¼š

1. **è§£ç»‘æˆåŠŸ**ï¼šç”¨æˆ·ç¡®å®æœ‰ç»‘å®šä¸”æˆåŠŸè§£ç»‘
2. **æœªç»‘å®š**ï¼šç”¨æˆ·ä»æœªç»‘å®šè¿‡è¯¥èº«ä»½
3. **å·²è§£ç»‘**ï¼šç”¨æˆ·å·²ç»å¤„äºè§£ç»‘çŠ¶æ€
4. **è§£ç»‘å¤±è´¥**ï¼šæ“ä½œè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. åˆ›å»ºè§£ç»‘ç»“æœæšä¸¾

æ–°å»º `UnbindResult` æšä¸¾æ¥è¡¨ç¤ºä¸åŒçš„è§£ç»‘çŠ¶æ€ï¼š

```java
@Getter
@AllArgsConstructor
public enum UnbindResult {
    SUCCESS("success", "è§£ç»‘æˆåŠŸ"),
    NOT_BOUND("not_bound", "ç”¨æˆ·æœªç»‘å®šè¯¥èº«ä»½"),
    ALREADY_UNBOUND("already_unbound", "ç”¨æˆ·å·²ç»å¤„äºè§£ç»‘çŠ¶æ€"),
    FAILED("failed", "è§£ç»‘å¤±è´¥");

    private final String code;
    private final String message;
}
```

### 2. æ‰©å±•Serviceæ¥å£

æ·»åŠ è¿”å›è¯¦ç»†çŠ¶æ€çš„è§£ç»‘æ–¹æ³•ï¼š

```java
/**
 * è§£ç»‘ç”¨æˆ·ä¸å®ä½“ï¼ˆè¿”å›è¯¦ç»†çŠ¶æ€ï¼‰
 */
UnbindResult unbindUserFromEntityWithResult(Long userId, UserEntityType entityType);
```

### 3. å®ç°è¯¦ç»†çŠ¶æ€æ£€æŸ¥

```java
@Override
public UnbindResult unbindUserFromEntityWithResult(Long userId, UserEntityType entityType) {
    // æŸ¥è¯¢åŒ…æ‹¬æ‰€æœ‰çŠ¶æ€çš„ç»‘å®šè®°å½•
    UserBinding binding = userBindingMapper.selectByUserIdAndEntityTypeAllStatus(userId, entityType.getCode());
    
    if (binding == null) {
        // ç”¨æˆ·ä»æœªç»‘å®šè¿‡è¯¥èº«ä»½
        return UnbindResult.NOT_BOUND;
    }
    
    if ("0".equals(binding.getBindingStatus())) {
        // ç”¨æˆ·å·²ç»å¤„äºè§£ç»‘çŠ¶æ€
        return UnbindResult.ALREADY_UNBOUND;
    }
    
    if ("1".equals(binding.getBindingStatus())) {
        // æ‰§è¡Œè§£ç»‘æ“ä½œ
        binding.setBindingStatus("0");
        if (updateById(binding)) {
            return UnbindResult.SUCCESS;
        } else {
            return UnbindResult.FAILED;
        }
    }
    
    // æœªçŸ¥çŠ¶æ€ï¼Œè¿”å›å¤±è´¥
    return UnbindResult.FAILED;
}
```

### 4. ä¼˜åŒ–Controllerå“åº”

ä¿®æ”¹è§£ç»‘æ¥å£ï¼Œæ ¹æ®ä¸åŒçŠ¶æ€è¿”å›ç›¸åº”ä¿¡æ¯ï¼š

```java
@PutMapping("/unbind/{entityType}")
public R<Void> unbindUserIdentity(@PathVariable String entityType) {
    Long userId = LoginHelper.getUserId();
    
    UserEntityType type = UserEntityType.getByCode(entityType);
    if (type == null) {
        return R.fail("æ— æ•ˆçš„å®ä½“ç±»å‹");
    }
    
    UnbindResult result = userBindingService.unbindUserFromEntityWithResult(userId, type);
    
    switch (result) {
        case SUCCESS:
            return R.ok("è§£ç»‘æˆåŠŸ");
        case NOT_BOUND:
            return R.fail("ç”¨æˆ·æœªç»‘å®šè¯¥èº«ä»½ï¼Œæ— éœ€è§£ç»‘");
        case ALREADY_UNBOUND:
            return R.fail("ç”¨æˆ·å·²ç»å¤„äºè§£ç»‘çŠ¶æ€");
        case FAILED:
        default:
            return R.fail("è§£ç»‘å¤±è´¥");
    }
}
```

## ğŸ”„ ä¼˜åŒ–åçš„APIè¡Œä¸º

### åœºæ™¯1ï¼šæˆåŠŸè§£ç»‘
**ç”¨æˆ·çŠ¶æ€**ï¼šå·²ç»‘å®šè®¾è®¡å¸ˆèº«ä»½  
**æ“ä½œ**ï¼š`PUT /designer/user/unbind/designer`  
**å“åº”**ï¼š
```json
{
    "code": 200,
    "msg": "è§£ç»‘æˆåŠŸ",
    "data": null
}
```

### åœºæ™¯2ï¼šç”¨æˆ·ä»æœªç»‘å®š
**ç”¨æˆ·çŠ¶æ€**ï¼šä»æœªç»‘å®šè¿‡è®¾è®¡å¸ˆèº«ä»½  
**æ“ä½œ**ï¼š`PUT /designer/user/unbind/designer`  
**å“åº”**ï¼š
```json
{
    "code": 500,
    "msg": "ç”¨æˆ·æœªç»‘å®šè¯¥èº«ä»½ï¼Œæ— éœ€è§£ç»‘",
    "data": null
}
```

### åœºæ™¯3ï¼šç”¨æˆ·å·²ç»è§£ç»‘
**ç”¨æˆ·çŠ¶æ€**ï¼šä¹‹å‰ç»‘å®šè¿‡ä½†å·²è§£ç»‘  
**æ“ä½œ**ï¼š`PUT /designer/user/unbind/designer`  
**å“åº”**ï¼š
```json
{
    "code": 500,
    "msg": "ç”¨æˆ·å·²ç»å¤„äºè§£ç»‘çŠ¶æ€",
    "data": null
}
```

### åœºæ™¯4ï¼šè§£ç»‘å¤±è´¥
**ç”¨æˆ·çŠ¶æ€**ï¼šæœ‰ç»‘å®šä½†æ“ä½œå¤±è´¥  
**æ“ä½œ**ï¼š`PUT /designer/user/unbind/designer`  
**å“åº”**ï¼š
```json
{
    "code": 500,
    "msg": "è§£ç»‘å¤±è´¥",
    "data": null
}
```

### åœºæ™¯5ï¼šæ— æ•ˆå®ä½“ç±»å‹
**æ“ä½œ**ï¼š`PUT /designer/user/unbind/invalid_type`  
**å“åº”**ï¼š
```json
{
    "code": 500,
    "msg": "æ— æ•ˆçš„å®ä½“ç±»å‹",
    "data": null
}
```

## ğŸ“‹ çŠ¶æ€è½¬æ¢å›¾

```mermaid
stateDiagram-v2
    [*] --> æœªç»‘å®š : åˆå§‹çŠ¶æ€
    æœªç»‘å®š --> å·²ç»‘å®š : æ³¨å†Œèº«ä»½
    å·²ç»‘å®š --> å·²è§£ç»‘ : è§£ç»‘æˆåŠŸ
    å·²è§£ç»‘ --> å·²ç»‘å®š : é‡æ–°æ³¨å†Œ
    
    æœªç»‘å®š --> æœªç»‘å®š : è§£ç»‘æ“ä½œ(NOT_BOUND)
    å·²è§£ç»‘ --> å·²è§£ç»‘ : è§£ç»‘æ“ä½œ(ALREADY_UNBOUND)
    å·²ç»‘å®š --> å·²ç»‘å®š : è§£ç»‘å¤±è´¥(FAILED)
    å·²ç»‘å®š --> å·²è§£ç»‘ : è§£ç»‘æˆåŠŸ(SUCCESS)
```

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯•æµç¨‹1ï¼šæ­£å¸¸è§£ç»‘æµç¨‹
```bash
# 1. æ³¨å†Œè®¾è®¡å¸ˆ
POST /designer/user/register/designer
# å“åº”ï¼š{"code": 200, "msg": "æ“ä½œæˆåŠŸ"}

# 2. é¦–æ¬¡è§£ç»‘
PUT /designer/user/unbind/designer
# é¢„æœŸï¼š{"code": 200, "msg": "è§£ç»‘æˆåŠŸ"}

# 3. é‡å¤è§£ç»‘
PUT /designer/user/unbind/designer
# é¢„æœŸï¼š{"code": 500, "msg": "ç”¨æˆ·å·²ç»å¤„äºè§£ç»‘çŠ¶æ€"}

# 4. éªŒè¯ç»‘å®šçŠ¶æ€
GET /designer/user/bindings
# é¢„æœŸï¼š{"code": 200, "data": []}
```

### æµ‹è¯•æµç¨‹2ï¼šä»æœªç»‘å®šçš„è§£ç»‘
```bash
# 1. ç›´æ¥è§£ç»‘ï¼ˆæœªæ³¨å†Œè¿‡ï¼‰
PUT /designer/user/unbind/designer
# é¢„æœŸï¼š{"code": 500, "msg": "ç”¨æˆ·æœªç»‘å®šè¯¥èº«ä»½ï¼Œæ— éœ€è§£ç»‘"}

# 2. éªŒè¯ç»‘å®šçŠ¶æ€
GET /designer/user/bindings
# é¢„æœŸï¼š{"code": 200, "data": []}
```

### æµ‹è¯•æµç¨‹3ï¼šæ— æ•ˆå®ä½“ç±»å‹
```bash
# 1. ä½¿ç”¨æ— æ•ˆç±»å‹
PUT /designer/user/unbind/invalid_type
# é¢„æœŸï¼š{"code": 500, "msg": "æ— æ•ˆçš„å®ä½“ç±»å‹"}
```

## ğŸ“Š æ•°æ®åº“çŠ¶æ€å¯¹ç…§

| æ•°æ®åº“çŠ¶æ€ | è§£ç»‘æ“ä½œç»“æœ | APIå“åº” |
|------------|-------------|---------|
| æ— è®°å½• | NOT_BOUND | "ç”¨æˆ·æœªç»‘å®šè¯¥èº«ä»½ï¼Œæ— éœ€è§£ç»‘" |
| binding_status = '1' | SUCCESS | "è§£ç»‘æˆåŠŸ" |
| binding_status = '0' | ALREADY_UNBOUND | "ç”¨æˆ·å·²ç»å¤„äºè§£ç»‘çŠ¶æ€" |
| æ›´æ–°å¤±è´¥ | FAILED | "è§£ç»‘å¤±è´¥" |

## âœ… ä¼˜åŒ–æ•ˆæœ

### ç”¨æˆ·ä½“éªŒæ”¹è¿›
1. **æ¸…æ™°åé¦ˆ**ï¼šç”¨æˆ·æ˜ç¡®çŸ¥é“æ“ä½œçš„å®é™…ç»“æœ
2. **å‡å°‘å›°æƒ‘**ï¼šä¸ä¼šåœ¨æ— ç»‘å®šæ—¶è¯¯ä»¥ä¸ºæ“ä½œæˆåŠŸ
3. **è°ƒè¯•å‹å¥½**ï¼šå¼€å‘è€…å¯ä»¥æ ¹æ®ä¸åŒçŠ¶æ€è¿›è¡Œç›¸åº”å¤„ç†

### APIè¯­ä¹‰æ”¹è¿›
1. **RESTfulåŸåˆ™**ï¼šæ“ä½œç»“æœä¸å®é™…çŠ¶æ€ä¸€è‡´
2. **å¹‚ç­‰æ€§è¯´æ˜**ï¼šé‡å¤æ“ä½œæ—¶æ˜ç¡®å‘ŠçŸ¥åŸå› 
3. **é”™è¯¯åŒºåˆ†**ï¼šä¸åŒé”™è¯¯æƒ…å†µæœ‰ä¸åŒçš„é”™è¯¯ä¿¡æ¯

### ç³»ç»Ÿå¥å£®æ€§
1. **çŠ¶æ€æ£€æŸ¥**ï¼šåœ¨æ“ä½œå‰æ£€æŸ¥å½“å‰çŠ¶æ€
2. **å¼‚å¸¸å¤„ç†**ï¼šå¤„ç†å„ç§è¾¹ç•Œæƒ…å†µ
3. **æ—¥å¿—è®°å½•**ï¼šæ“ä½œæ—¥å¿—æ›´åŠ å‡†ç¡®

## ğŸ” ä¸å…¶ä»–æ¥å£çš„ä¸€è‡´æ€§

ç¡®ä¿å…¶ä»–ç›¸å…³æ¥å£ä¹Ÿæœ‰ç±»ä¼¼çš„æ¸…æ™°å“åº”ï¼š

### ç»‘å®šçŠ¶æ€æŸ¥è¯¢
```json
// æœ‰ç»‘å®šæ—¶
{"code": 200, "msg": "æŸ¥è¯¢æˆåŠŸ", "data": [...]}

// æ— ç»‘å®šæ—¶
{"code": 200, "msg": "æŸ¥è¯¢æˆåŠŸ", "data": []}
```

### èº«ä»½ä¿¡æ¯æŸ¥è¯¢
```json
// æœ‰ç»‘å®šæ—¶
{"code": 200, "msg": "æŸ¥è¯¢æˆåŠŸ", "data": {...}}

// æ— ç»‘å®šæ—¶
{"code": 500, "msg": "ç”¨æˆ·æœªç»‘å®šè®¾è®¡å¸ˆèº«ä»½", "data": null}
```

è¿™ç§è®¾è®¡ç¡®ä¿äº†æ•´ä¸ªAPIç³»ç»Ÿçš„ä¸€è‡´æ€§å’Œç”¨æˆ·å‹å¥½æ€§ã€‚ 